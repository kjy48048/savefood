<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="com.ward.savefood.fridge.dao.FridgeDao">
	<select id="getStorage" resultType="java.util.HashMap">
		SELECT
			saveplace_storage_code,
			saveplace_storage_name
		FROM
			saveplace_storage
	</select>
	
	<select id="getMemberSeq" resultType="String">
		SELECT
			member_seq
		FROM
			member
		WHERE
			member_id = #{memberId}
	</select>
	
	<select id="getFridgeList" resultType="java.util.HashMap">
		SELECT fridge_seq, fridge_name, fridge_ord
		FROM
			fridge
		WHERE 
			member_seq = #{memberSeq}
			AND is_delete = 'N'
		ORDER BY fridge_ord;
	</select>
	
	<select id="getSaveplace" resultType="java.util.HashMap">
		SELECT a.saveplace_seq, a.fridge_seq, a.saveplace_name, b.fridge_ord
		FROM
			saveplace a
		LEFT JOIN fridge b ON a.fridge_seq = b.fridge_seq
		WHERE
			<foreach collection="fridgeSeqList" item="item" separator="or" index="index">
			a.fridge_seq = #{item}
			</foreach>
			AND a.is_delete = 'N'
			ORDER BY b.fridge_ord;
<!-- 			<choose>
				<when test="fridgeSeqList.size() != 0">
				AND is_delete = 'N';
				</when>
				<otherwise>
				is_delete = 'N';
				</otherwise>
			</choose> -->
	</select>
	
	<select id="getSavefoodList" resultType="java.util.HashMap">
		SELECT
			*, count(*) as count
		FROM
			savefood
		WHERE
			<foreach collection="saveplaceSeqList" item="item" separator="or" index="index">
			saveplace_seq = #{item}
			</foreach>
			AND is_delete = 'N';
	</select>
	
	<select id="getSaveplaceList" parameterType="String" resultType="java.util.HashMap">
		SELECT
			a.saveplace_seq,
			a.saveplace_name
		FROM saveplace a
		LEFT JOIN fridge b ON a.fridge_seq = b.fridge_seq
		WHERE
			a.fridge_seq = #{fridgeSeq}
			AND a.is_delete = 'N'
		ORDER BY saveplace_seq;
	</select>
	
	<insert id="insertSaveplace" useGeneratedKeys="true" keyProperty="saveplaceSeq">
		INSERT INTO
			saveplace (fridge_seq, saveplace_name, saveplace_strorage_code,  insert_date)
		VALUES
			(#{fridgeSeq}, #{saveplace}, #{storage}, now());
	</insert>	

	<update id="updateSaveplace" parameterType="java.util.HashMap">
		UPDATE
			saveplace
		SET
			saveplace_name = #{saveplaceName},
			modify_date = now()
		WHERE
			saveplace_seq = #{saveplaceSeq};
	</update>	
	
	<update id="deleteSaveplace" parameterType="java.util.HashMap">
		UPDATE
			saveplace
		SET
			is_delete = 'Y',
			modify_date = now()
		WHERE
			saveplace_seq = #{saveplaceSeq};
	</update>
	
</mapper>